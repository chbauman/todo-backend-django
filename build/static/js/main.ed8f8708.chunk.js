(this["webpackJsonptodo-app"]=this["webpackJsonptodo-app"]||[]).push([[0],{53:function(e,t,n){},55:function(e,t,n){},75:function(e,t,n){},80:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(12),c=n.n(o),s=(n(53),n(2)),i=n(9),u=n.n(i),d=n(11),l=n(8),h=n(83),p=n(87),j=n(88),f=n(84),b=(n(55),n(16)),O=n(17),v=n(37),g=n(34),x=n(36),m=n(41),k=n(90),y=function(){return Object(k.a)()},w=function(e){return"group"===e.type},T=new(function(){function e(){Object(b.a)(this,e),this.todoTree=void 0,this.root=void 0,this.subTreeRoot=void 0,this.onChangedCbDict={},this.initialized=!1,this.init({})}return Object(O.a)(e,[{key:"init",value:function(e,t){if(void 0===t){var n=this.generateNewId(),r={name:"root",type:"group",parentId:null,id:n,childrenIds:[],createdAt:null};this.todoTree={},this.todoTree[n]=r,this.root=r,this.subTreeRoot={groupList:[],todo:r}}else this.todoTree=e,this.subTreeRoot={groupList:[],todo:t},this.root=t}},{key:"setGroupAsSelected",value:function(e){this.subTreeRoot=e}},{key:"registerOnChanged",value:function(e,t){this.onChangedCbDict[e]=t}},{key:"changeHappened",value:function(){var e=this;Object.keys(this.onChangedCbDict).forEach((function(t){e.onChangedCbDict[t]()}))}},{key:"getAllGroups",value:function(){var e=this;return Object.keys(this.todoTree).map((function(t){return e.todoTree[t]})).filter(w)}},{key:"setToDone",value:function(e){var t=this.todoTree[e];if(w(t))throw new Error("This is a bug, cannot set a group to DONE");t.done=new Date,this.changeHappened()}},{key:"generateNewId",value:function(){return y()}},{key:"addGroup",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=Object(s.a)(Object(s.a)({},this.getNewBaseObject(t)),{},{name:e,type:"group",childrenIds:[]});return this.todoTree[n.id]=n,this.changeHappened(),n.id}},{key:"addTodo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=Object(s.a)(Object(s.a)({},this.getNewBaseObject(t)),{},{text:e,done:null,type:"todo"});return this.todoTree[n.id]=n,this.changeHappened(),n.id}},{key:"getNewBaseObject",value:function(e){var t=this.getParent(e),n={id:this.generateNewId(),parentId:t.id,createdAt:new Date};return t.childrenIds.push(n.id),n}},{key:"getParent",value:function(e){var t=null===e?this.root.id:e,n=this.todoTree[t];if(!w(n))throw new Error("Parent is not a group!!");return n}},{key:"deleteTodo",value:function(e){var t=this,n=this.todoTree[e];w(n)&&n.childrenIds.forEach((function(e){t.deleteTodo(e)}));var r=this.getParent(n.parentId);r.childrenIds=r.childrenIds.filter((function(t){return t!==e})),delete this.todoTree[e],this.changeHappened()}},{key:"getGroupList",value:function(){var e=[this.root],t=this.root;return this.getGroupListHelper(e,t),e}},{key:"getGroupListHelper",value:function(e,t){var n,r=Object(m.a)(t.childrenIds);try{for(r.s();!(n=r.n()).done;){var a=n.value,o=this.todoTree[a];w(o)&&(e.push(o),this.getGroupListHelper(e,o))}}catch(c){r.e(c)}finally{r.f()}}},{key:"getTodoList",value:function(){var e={};return this.getTodoListHelper(e,[],this.subTreeRoot.todo),e}},{key:"getTodoListHelper",value:function(e,t,n){if(w(n)){var r,a=[].concat(Object(x.a)(t),[n]),o=Object(m.a)(n.childrenIds);try{for(o.s();!(r=o.n()).done;){var c=r.value,s=this.todoTree[c];this.getTodoListHelper(e,a,s)}}catch(i){o.e(i)}finally{o.f()}}else e[n.id]={todo:n,groupList:t}}}]),e}()),C=function(){function e(){Object(b.a)(this,e),this.loadedTodos=null,this.loadedGroups=null}return Object(O.a)(e,[{key:"convertAndInit",value:function(){if(null!==this.loadedTodos&&null!==this.loadedGroups){var e={},t={};this.loadedGroups.forEach((function(n){var r=y(),a={createdAt:n.created,name:n.name,type:"group",id:r,childrenIds:[],parentId:null};e[n.name]=a,t[r]=a})),this.loadedTodos.forEach((function(n){var r=e[n.parent_group_name],a=y();r.childrenIds.push(a);var o={parentId:r.id,id:a,type:"todo",text:n.text,createdAt:n.created,done:n.done};t[a]=o})),this.loadedGroups.forEach((function(t){if(t.parent_id){var n=e[t.parent_id],r=e[t.name];r.parentId=n.id,n.childrenIds.push(r.id)}}));var n=e.root;T.init(t,n)}else console.log("Fuck")}},{key:"prepareSaving",value:function(){var e=T.todoTree,t=T.getAllGroups();this.loadedGroups=t.map((function(t){var n=t.parentId?e[t.parentId]:null,r=null;return null!==n&&(r=n.name),{created:t.createdAt,name:t.name,parent_id:r}}));var n=Object.values(T.getTodoList()).map((function(e){return e.todo}));this.loadedTodos=n.map((function(t){var n=e[t.parentId];return{created:t.createdAt,text:t.text,done:t.done,parent_group_name:n.name,id:null}}))}}]),e}(),I=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).DEBUG,L=I?"http://127.0.0.1:8000/":"https://chbauman.pythonanywhere.com/";console.log("Debug: ",I,L);var G={"Content-Type":"application/json"},N="currUserToken",D=new(function(e){Object(v.a)(n,e);var t=Object(g.a)(n);function n(){var e;return Object(b.a)(this,n),(e=t.call(this)).userData=null,e.isLoggedIn(),e}return Object(O.a)(n,[{key:"getPostData",value:function(){var e=Object(d.a)(u.a.mark((function e(t,n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(t,{method:"POST",headers:G,body:JSON.stringify(n)}));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"loginUser",value:function(){var e=Object(d.a)(u.a.mark((function e(t){var n,r,a,o,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="".concat(L,"api-token-auth/"),e.next=3,this.getPostData(n,t);case 3:if(r=e.sent,!(a=r.ok)){e.next=14;break}return e.next=8,r.json();case 8:return o=e.sent,c={token:o.token,userName:t.username},localStorage.setItem(N,JSON.stringify(c)),this.userData=c,e.next=14,this.loadUserData();case 14:return e.abrupt("return",a);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isLoggedIn",value:function(){var e=localStorage.getItem(N),t=null!==e;return t&&(this.userData=JSON.parse(e)),t}},{key:"loadUserData",value:function(){var e=Object(d.a)(u.a.mark((function e(){var t,n,r,a,o,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="".concat(L,"todo_items/"),e.next=3,this.get(t);case 3:return n=e.sent,e.next=6,n.json();case 6:if(r=e.sent,n.ok){e.next=10;break}return console.log("Failed to fetch todos",r),e.abrupt("return");case 10:return a="".concat(L,"todo_groups/"),e.next=13,this.get(a);case 13:return o=e.sent,e.next=16,o.json();case 16:if(c=e.sent,n.ok){e.next=20;break}return console.log("Failed to fetch groups",c),e.abrupt("return");case 20:this.loadedTodos=r,this.loadedGroups=c,this.convertAndInit();case 23:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(d.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(t,{method:"GET",headers:this.getAuthHeader()}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"post",value:function(){var e=Object(d.a)(u.a.mark((function e(t,n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(t,{method:"POST",headers:this.getAuthHeader(),body:JSON.stringify(n)}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getAuthHeader",value:function(){var e;if(null===this.userData)throw new Error("Not logged in!");return Object(s.a)(Object(s.a)({},G),{},{Authorization:"Token ".concat(null===(e=this.userData)||void 0===e?void 0:e.token)})}},{key:"save",value:function(){var e=Object(d.a)(u.a.mark((function e(){var t,n,r,a,o,c,s,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.prepareSaving(),null!==this.loadedGroups&&null!==this.loadedTodos){e.next=3;break}return e.abrupt("return",!1);case 3:return t="".concat(L,"todo_groups/"),e.next=6,this.post(t,this.loadedGroups);case 6:if(n=e.sent,r=n.ok){e.next=13;break}return e.next=11,n.json();case 11:a=e.sent,console.log("fuck",n,this.loadedGroups,a);case 13:return o="".concat(L,"todo_items/"),e.next=16,this.post(o,this.loadedTodos);case 16:return c=e.sent,(s=c.ok)||console.log(n,this.loadedTodos),(i=r&&s)||console.log("Fuck"),e.abrupt("return",i);case 22:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createAccountAndLogin",value:function(){var e=Object(d.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="".concat(L,"create_user/"),e.next=3,this.getPostData(n,t);case 3:if(e.sent.ok){e.next=6;break}return e.abrupt("return",null);case 6:return e.next=8,this.loginUser(t);case 8:if(!e.sent){e.next=11;break}return e.abrupt("return",t.username);case 11:return e.abrupt("return",null);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"logout",value:function(){this.userData=null,localStorage.removeItem(N)}},{key:"getUser",value:function(){return this.isLoggedIn()&&null!==this.userData?this.userData.userName:null}}]),n}(C));window.djangoInterface=D;var A=n(89),S=n(1),E=function(e){var t=e.setLogin,n=e.setCreatingAccount,a=Object(r.useState)({password:"",username:""}),o=Object(l.a)(a,2),c=o[0],i=o[1];return Object(S.jsxs)(h.a,{children:[Object(S.jsx)("h5",{children:"Login"}),Object(S.jsxs)(A.a,{children:[Object(S.jsxs)(A.a.Group,{controlId:"formUser",children:[Object(S.jsx)(A.a.Label,{children:"Enter username:"}),Object(S.jsx)(A.a.Control,{type:"text",onChange:function(e){return i(Object(s.a)(Object(s.a)({},c),{},{username:e.target.value}))}})]}),Object(S.jsxs)(A.a.Group,{controlId:"formPassword",children:[Object(S.jsx)(A.a.Label,{children:"Enter password:"}),Object(S.jsx)(A.a.Control,{type:"password",onChange:function(e){return i(Object(s.a)(Object(s.a)({},c),{},{password:e.target.value}))}})]}),Object(S.jsx)(f.a,{onClick:function(){return t(c)},children:"Login"})]}),Object(S.jsx)(f.a,{onClick:function(){return n(!0)},children:"Create new account."})]})},_=n(47),P=n(85),H=n(45);function U(e){return Object(S.jsx)("h5",{children:e.text})}var B=function(e){var t=Object(r.useState)(0),n=Object(l.a)(t,2),a=n[0],o=n[1];T.registerOnChanged(e,(function(){return o(a+1)}))};function z(){return R("New Group:",(function(e,t){return T.addGroup(e,t)}),"new-group")}function F(){return R("New task:",(function(e,t){return T.addTodo(e,t)}),"new-todo")}var R=function(e,t,n){var a=Object(r.useRef)(null),o=Object(r.useRef)(null);B(n);return Object(S.jsxs)(S.Fragment,{children:[Object(S.jsx)(P.a,{className:"mt-2",children:Object(S.jsx)(H.a,{children:Object(S.jsx)(U,{text:e})})}),Object(S.jsxs)(P.a,{children:[Object(S.jsx)(A.a.Group,{as:H.a,md:8,controlId:"text-"+n,children:Object(S.jsx)(A.a.Control,{type:"text",placeholder:"Task XYZ",ref:a})}),Object(S.jsx)(A.a.Group,{as:H.a,md:3,controlId:"group-select-"+n,children:Object(S.jsx)(J,{onChangeCB:function(e){o.current=e}})}),Object(S.jsx)(A.a.Group,{as:H.a,md:1,controlId:"submit-"+n,children:Object(S.jsx)(f.a,{onClick:function(){var e=a.current;""!==e.value&&(t(e.value,o.current),e.value="")},children:"Add"})})]})]})},J=function(e){var t=e.onChangeCB,n=T.getAllGroups().map((function(e){return{value:e.id,label:e.name}}));B("groups-selection");var a=Object(r.useState)(null),o=Object(l.a)(a,2),c=o[0],s=o[1];return Object(S.jsx)(_.a,{defaultValue:c,onChange:function(e){s(e),t(null===e||void 0===e?void 0:e.value)},options:n})},K=n(86);n(75);function W(e){var t=function(e){var t=e.todo.text,n=e.currentGroup.groupList,r={fontSize:"12px",marginBottom:0,paddingBottom:0},a=Object(S.jsx)(S.Fragment,{children:e.currParentGroups.map((function(t,a){var o=0===a?"mb-0":"ms-1 mb-0";return Object(S.jsx)("div",{className:"group-list float-start "+o,onClick:function(){var r=e.currParentGroups.slice(0,a);e.setGroup({todo:t,groupList:n.concat(r)})},style:r,children:t.name+" / "},t.id)}))});return Object(S.jsxs)("div",{children:[a,Object(S.jsx)("br",{}),Object(S.jsx)("div",{className:"textdiv mb-2",style:{paddingTop:0,marginTop:"-10px"},children:t})]})}(e),n=e.todo.done?null:Object(S.jsx)(f.a,{size:"sm",onClick:function(){T.setToDone(e.todo.id)},children:"Done"}),r=Object(S.jsxs)(K.a,{children:[n,Object(S.jsx)(f.a,{size:"sm",variant:"danger",onClick:function(){return T.deleteTodo(e.todo.id)},children:"Delete"})]});return Object(S.jsx)(S.Fragment,{children:Object(S.jsxs)(P.a,{children:[Object(S.jsx)(H.a,{md:9,children:t}),Object(S.jsx)(H.a,{md:3,children:r})]})})}var V=function(e,t){if(null===e||null===t)return NaN;var n=e.valueOf(),r=t.valueOf(),a=Number(n>r),o=Number(n<r);return isFinite(n)&&isFinite(r)?a-o:NaN};function M(e){B("pending");var t=T.getTodoList(),n=Object.keys(t).map((function(e){return t[e]})),r=n.filter((function(e){return null!==e.todo.done})),a=n.filter((function(e){return null===e.todo.done}));a.sort((function(e,t){return-V(e.todo.createdAt,t.todo.createdAt)})),r.sort((function(e,t){return-V(e.todo.done,t.todo.done)}));var o=function(t){var n=t.todo;return Object(S.jsx)(W,{todo:n,currParentGroups:t.groupList,setGroup:e.setGroup,currentGroup:e.currentGroup},n.id)};return Object(S.jsxs)(P.a,{className:"mt-2",children:[Object(S.jsxs)(H.a,{md:8,children:[Object(S.jsx)(U,{text:"Open tasks:"}),a.map(o)]}),Object(S.jsxs)(H.a,{md:4,children:[Object(S.jsx)(U,{text:"Completed:"}),r.map(o)]})]})}var X=function(e){var t=e.setCreatingAccount,n=e.setLoggedIn,a=Object(r.useState)({password:"",username:"",email:"",lastname:""}),o=Object(l.a)(a,2),c=o[0],i=o[1],p=function(){var e=Object(d.a)(u.a.mark((function e(){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.createAccountAndLogin(c);case 2:null!==(r=e.sent)?(t(!1),n(r)):console.log("Account creation failed!");case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(S.jsxs)(h.a,{children:[Object(S.jsx)("h5",{children:"Create Account"}),Object(S.jsxs)(A.a,{children:[Object(S.jsxs)(A.a.Group,{controlId:"formUser",children:[Object(S.jsx)(A.a.Label,{children:"Username: *"}),Object(S.jsx)(A.a.Control,{type:"text",onChange:function(e){return i(Object(s.a)(Object(s.a)({},c),{},{username:e.target.value}))}})]}),Object(S.jsxs)(A.a.Group,{controlId:"formEmail",children:[Object(S.jsx)(A.a.Label,{children:"Email: *"}),Object(S.jsx)(A.a.Control,{type:"email",onChange:function(e){return i(Object(s.a)(Object(s.a)({},c),{},{email:e.target.value}))}})]}),Object(S.jsxs)(A.a.Group,{controlId:"formLastName",children:[Object(S.jsx)(A.a.Label,{children:"Last Name:"}),Object(S.jsx)(A.a.Control,{type:"text",onChange:function(e){return i(Object(s.a)(Object(s.a)({},c),{},{lastname:e.target.value}))}})]}),Object(S.jsxs)(A.a.Group,{controlId:"formPassword",children:[Object(S.jsx)(A.a.Label,{children:"Password: *"}),Object(S.jsx)(A.a.Control,{type:"password",onChange:function(e){return i(Object(s.a)(Object(s.a)({},c),{},{password:e.target.value}))}})]}),Object(S.jsx)(f.a,{onClick:p,children:"Create"})]}),Object(S.jsx)(f.a,{onClick:function(){return t(!1)},children:"Back to Login"})]})},Y=function(){var e=Object(d.a)(u.a.mark((function e(t,n){var r,a,o,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Date.now(),e.next=3,t();case 3:if(a=e.sent,o=Date.now()-r,!((c=n-o)>0)){e.next=9;break}return e.next=9,new Promise((function(e){return setTimeout(e,c)}));case 9:return e.abrupt("return",a);case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Z=function(e){var t=e.userName,n=e.logout,a=T.root,o=Object(r.useState)({todo:a,groupList:[]}),c=Object(l.a)(o,2),s=c[0],i=c[1],u=function(e){i(e),T.setGroupAsSelected(e)};return Object(S.jsxs)(h.a,{children:[q(s,u,t,n),Object(S.jsx)(F,{}),Object(S.jsx)(z,{}),Object(S.jsx)(M,{setGroup:u,currentGroup:s})]})},q=function(e,t,n,r){var a=e.todo.name,o=e.groupList;return Object(S.jsxs)(p.a,{bg:"light",expand:"md",children:[Object(S.jsx)(p.a.Brand,{href:"/",children:a}),Object(S.jsx)(p.a.Toggle,{"aria-controls":"basic-navbar-nav"}),Object(S.jsxs)(p.a.Collapse,{id:"basic-navbar-nav",children:[Object(S.jsxs)(j.a,{className:"me-auto",children:[o.map((function(e,n){return Object(S.jsx)(j.a.Link,{onClick:function(){var r=o.slice(0,n);t({todo:e,groupList:r})},children:"".concat(e.name," /")},"nav-".concat(e.id))})),Object(S.jsx)(j.a.Link,{onClick:function(){return console.log("Ignoring your stupid click!")},children:a})]}),Object(S.jsx)(f.a,{onClick:function(){return D.save()},children:"Save"}),Object(S.jsxs)(j.a,{children:["User: ",n]}),Object(S.jsx)(f.a,{onClick:r,children:"Logout"})]})]})},Q=function(){var e=D.getUser(),t="initialized";null===e?t="login":T.initialized||(t="load-data");var n=Object(r.useState)({state:t,userName:e}),a=Object(l.a)(n,2),o=a[0],c=a[1],i=function(e){return c({state:"initialized",userName:e})},p=o.userName,j=function(){c({state:"create-account",userName:null})};if("create-account"===o.state)return Object(S.jsx)(X,{setCreatingAccount:j,setLoggedIn:i});if(null===p){var f=function(){var e=Object(d.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.loginUser(t);case 2:e.sent&&i(t.username);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(S.jsx)(E,{setLogin:f,setCreatingAccount:j})}if(!T.initialized)return function(){var e=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Y((function(){return D.loadUserData()}),400);case 2:T.initialized=!0,c(Object(s.a)(Object(s.a)({},o),{},{state:"initialized"}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()(),Object(S.jsx)(h.a,{children:Object(S.jsx)("h2",{children:"Loading..."})});return Object(S.jsx)(Z,{userName:p,logout:function(){D.logout(),i(null)}})};n(79);c.a.render(Object(S.jsx)(a.a.StrictMode,{children:Object(S.jsx)(Q,{})}),document.getElementById("root"))}},[[80,1,2]]]);
//# sourceMappingURL=main.ed8f8708.chunk.js.map